// Lightweight ESM wrapper that ensures a same-origin UMD JSZip is loaded
// The wrapper exports the global `JSZip` as the default export so other modules
// can `import JSZip from '/js/lib/jszip.esm.min.js'` even though we ship a UMD build.

// This file uses top-level await which is valid in ESM modules.

if (typeof window === "undefined") {
  throw new Error("JSZip ESM wrapper must run in a browser environment");
}

if (!window.JSZip) {
  await new Promise((resolve, reject) => {
    const script = document.createElement("script");
    script.src = "/js/lib/jszip.min.js"; // same-origin UMD build
    script.async = true;
    script.onload = () => {
      if (window.JSZip) return resolve();
      reject(new Error("JSZip loaded but window.JSZip is not defined"));
    };
    script.onerror = (e) =>
      reject(new Error("Failed to load /js/lib/jszip.min.js"));
    document.head.appendChild(script);
  });
}

if (!window.JSZip) {
  throw new Error("JSZip not available after loading /js/lib/jszip.min.js");
}

export default window.JSZip;
