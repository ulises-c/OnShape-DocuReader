<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OnShape DocuReader</title>
    <link rel="stylesheet" href="css/main.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>üîß OnShape DocuReader</h1>
            <p>Access and browse your OnShape documents using OAuth integration</p>
        </header>

        <main>
            <!-- Landing Page -->
            <div id="landing" class="page active">
                <div class="welcome-card">
                    <h2>Welcome to OnShape DocuReader</h2>
                    <p>This application allows you to securely access your OnShape documents using OAuth 2.0 authentication.</p>
                    
                    <div class="features">
                        <h3>Features:</h3>
                        <ul>
                            <li>üîê Secure OAuth 2.0 authentication with OnShape</li>
                            <li>üìÑ Browse your OnShape documents</li>
                            <li>üîç View document details and elements</li>
                            <li>‚öôÔ∏è Access parts and assemblies information</li>
                            <li>üìä Get mass properties and metadata</li>
                        </ul>
                    </div>

                    <div class="auth-section">
                        <button id="loginBtn" class="btn btn-primary">
                            Login with OnShape
                        </button>
                        <p class="auth-status" id="authStatus">Not authenticated</p>
                    </div>
                </div>
            </div>

            <!-- Dashboard -->
            <div id="dashboard" class="page">
                <div class="dashboard-header">
                    <h2>Your OnShape Documents</h2>
                    <div class="user-info">
                        <span id="userName">Loading...</span>
                        <button id="logoutBtn" class="btn btn-secondary">Logout</button>
                    </div>
                </div>

                <div class="search-section">
                    <input type="text" id="searchInput" placeholder="Search documents..." />
                    <button id="searchBtn" class="btn btn-primary">Search</button>
                    <button id="refreshBtn" class="btn btn-secondary">Refresh</button>
                    <button id="getAllBtn" class="btn btn-success">üì¶ Get All</button>
                    <button id="getSelectedBtn" class="btn btn-info" disabled>üìã Get Selected</button>
                    <button id="exportCSVBtn" class="btn btn-warning">üìä Export CSV [ASM/PRT]</button>
                </div>

                <div class="documents-section" data-scroll-preserve data-scroll-key="documents-section">
                    <div id="loading" class="loading">Loading documents...</div>
                    <div id="documentsGrid" class="documents-grid"></div>
                    <div id="error" class="error-message" style="display: none;"></div>
                </div>
            </div>

            <!-- Document Detail -->
            <div id="documentDetail" class="page">
                <div class="detail-header">
                    <button id="backBtn" class="btn btn-secondary">‚Üê Back to Documents</button>
                    <h2 id="documentTitle">Document Details</h2>
                    <button id="getDocumentBtn" class="btn btn-primary">üì¶ Get JSON</button>
                </div>

                <div class="document-info" data-scroll-preserve data-scroll-key="document-info">
                    <div class="info-card">
                        <h3>Document Information</h3>
                        <div id="documentInfo"></div>
                    </div>

                    <div class="info-card">
                        <h3>Elements</h3>
                        <div id="documentElements"></div>
                    </div>
                </div>
            </div>

            <!-- Element Detail -->
            <div id="elementDetail" class="page">
                <div class="detail-header">
                    <button id="backToDocBtn" class="btn btn-secondary">‚Üê Back to Document</button>
                    <h2 id="elementTitle">Element Details</h2>
                </div>

                <div class="element-info" data-scroll-preserve data-scroll-key="element-detail">
                    <div class="info-card">
                        <h3>Element Information</h3>
                        <div id="elementInfo"></div>
                    </div>

                    <div class="tabs">
                        <button class="tab-btn active" data-tab="parts">Parts</button>
                        <button class="tab-btn" data-tab="assemblies">Assemblies</button>
                        <button class="tab-btn" data-tab="metadata">Metadata</button>
                    </div>

                    <div class="tab-content">
                        <div id="parts-tab" class="tab-panel active">
                            <div class="info-card">
                                <h3>Parts</h3>
                                <div id="elementParts" class="parts-grid"></div>
                            </div>
                        </div>

                        <div id="assemblies-tab" class="tab-panel">
                            <div class="info-card">
                                <h3>Assemblies</h3>
                                <div id="elementAssemblies" class="assemblies-grid"></div>
                            </div>
                        </div>

                        <div id="metadata-tab" class="tab-panel">
                            <div class="info-card">
                                <h3>Metadata</h3>
                                <div id="elementMetadata"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Part Detail -->
            <div id="partDetail" class="page">
                <div class="detail-header">
                    <button id="backToElementBtn" class="btn btn-secondary">‚Üê Back to Element</button>
                    <h2 id="partTitle">Part Details</h2>
                </div>

                <div class="part-info" data-scroll-preserve data-scroll-key="part-detail">
                    <div class="info-card">
                        <h3>Part Information</h3>
                        <div id="partInfo"></div>
                    </div>

                    <div class="info-card">
                        <h3>Mass Properties</h3>
                        <div id="partMassProperties"></div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Export Options Modal -->
        <div id="exportModal" class="modal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>üì¶ Export All Documents</h3>
                    <button class="modal-close" id="exportModalClose">&times;</button>
                </div>
                
                <div class="modal-body">
                    <div class="export-section">
                        <h4>üìã Data Types to Include</h4>
                        <div class="checkbox-group">
                            <label>
                                <input type="checkbox" id="exportBasicInfo" checked>
                                <span class="checkmark"></span>
                                Basic Document Info (name, creator, dates)
                            </label>
                            <label>
                                <input type="checkbox" id="exportElements" checked>
                                <span class="checkmark"></span>
                                Elements & Structure
                            </label>
                            <label>
                                <input type="checkbox" id="exportParts">
                                <span class="checkmark"></span>
                                Parts Data
                            </label>
                            <label>
                                <input type="checkbox" id="exportAssemblies">
                                <span class="checkmark"></span>
                                Assemblies Data
                            </label>
                            <label>
                                <input type="checkbox" id="exportMassProperties">
                                <span class="checkmark"></span>
                                Mass Properties
                            </label>
                            <label>
                                <input type="checkbox" id="exportMetadata">
                                <span class="checkmark"></span>
                                Metadata & Properties
                            </label>
                            <label>
                                <input type="checkbox" id="exportImages" disabled>
                                <span class="checkmark"></span>
                                Images & Thumbnails (Coming Soon)
                            </label>
                            <label>
                                <input type="checkbox" id="exportModels" disabled>
                                <span class="checkmark"></span>
                                3D Models (Coming Soon)
                            </label>
                        </div>
                    </div>

                    <div class="export-section">
                        <h4>üîÑ Version Control</h4>
                        <div class="radio-group">
                            <label>
                                <input type="radio" name="versionMode" value="new" checked>
                                Download only new/updated documents
                            </label>
                            <label>
                                <input type="radio" name="versionMode" value="all">
                                Download all documents (overwrite existing)
                            </label>
                            <label>
                                <input type="radio" name="versionMode" value="missing">
                                Download only missing documents
                            </label>
                        </div>
                        <p class="help-text">
                            <small>üóÇÔ∏è Previous exports are stored in browser cache for comparison</small>
                        </p>
                    </div>

                    <div class="export-section">
                        <h4>‚ö° Rate Limiting</h4>
                        <div class="rate-control">
                            <label for="requestsPerMinute">API Requests per minute:</label>
                            <select id="requestsPerMinute">
                                <option value="10">10 (Conservative)</option>
                                <option value="30" selected>30 (Recommended)</option>
                                <option value="60">60 (Aggressive)</option>
                                <option value="120">120 (Maximum)</option>
                            </select>
                            <p class="help-text">
                                <small>‚ö†Ô∏è OnShape has rate limits. Conservative settings prevent timeouts.</small>
                            </p>
                        </div>
                    </div>

                    <div class="export-section">
                        <h4>üìÅ Export Format</h4>
                        <div class="radio-group">
                            <label>
                                <input type="radio" name="exportFormat" value="json" checked>
                                Single JSON file
                            </label>
                            <label>
                                <input type="radio" name="exportFormat" value="zip">
                                ZIP with organized folders
                            </label>
                        </div>
                    </div>

                    <div class="export-summary">
                        <p><strong>Estimated documents:</strong> <span id="estimatedCount">0</span></p>
                        <p><strong>Estimated time:</strong> <span id="estimatedTime">0 minutes</span></p>
                    </div>
                </div>

                <div class="modal-footer">
                    <button class="btn btn-secondary" id="cancelExport">Cancel</button>
                    <button class="btn btn-success" id="startExport">Start Export</button>
                </div>
            </div>
        </div>

        <!-- Export Progress Modal -->
        <div id="progressModal" class="modal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>üöÄ Exporting Documents</h3>
                </div>
                
                <div class="modal-body">
                    <div class="progress-section">
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                        </div>
                        <p class="progress-text">
                            <span id="currentProgress">0</span> of <span id="totalProgress">0</span> documents
                        </p>
                    </div>

                    <div class="current-task">
                        <p><strong>Current:</strong> <span id="currentTask">Starting export...</span></p>
                        <p><strong>Rate:</strong> <span id="currentRate">0</span> requests/min</p>
                    </div>

                    <div class="export-log">
                        <h4>üìù Export Log</h4>
                        <div id="exportLog" class="log-container" data-scroll-preserve data-scroll-key="export-log">
                            <p>Initializing export...</p>
                        </div>
                    </div>
                </div>

                <div class="modal-footer">
                    <button class="btn btn-danger" id="cancelExportProgress">Cancel Export</button>
                </div>
            </div>
        </div>

        <footer>
            <p>&copy; 2025 OnShape DocuReader - Built with OnShape API</p>
        </footer>
    </div>

    <script type="module" src="js/app.js"></script>
</body>
</html>
